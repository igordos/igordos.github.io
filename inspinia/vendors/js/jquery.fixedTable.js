/*!
 * Fixed Table Header and Left Column
 * 
 * Copyright (c) 2013 nkmrshn
 *
 * Released under the MIT License.
 * http://www.opensource.org/licenses/MIT
 */
(function(a){a.fn.extend({fixedTblHdrLftCol:function(i){var j=a.extend(true,{scroll:{height:null,width:null,headRow:{className:"fTHLC-head-row",enabled:true,overflow:"auto"},leftCol:{className:"fTHLC-left-col",enabled:true,overflow:"auto",fixedSpan:1},syncWith:null},wrapper:{outer:{idName:null,className:"fTHLC-outer-wrapper"},inner:{idName:null,className:"fTHLC-inner-wrapper"}},corner:{append:true,deepClone:false,outer:{idName:null,className:"fTHLC-outer-corner"},inner:{idName:null,className:"fTHLC-inner-corner"}}},i);var o=j.scroll.width;var z=j.scroll.height;var k=null;var h=null;function u(F){var E=o;if(!E){E=F.outerWidth(true)-B(F)}return E}function y(F){var E=z;if(!E){E=F.outerHeight(true)-q(F)}return E}function r(E){return E.find("thead tr").length}function s(G){var H=a([]);for(var F=0;F<r(G);F++){var I=a([]);for(var E=0;E<j.scroll.leftCol.fixedSpan;E++){I.push(G.find("thead tr:nth-child("+(F+1)+") th:nth-child("+(E+1)+")"))}H.push(I)}return H}function n(F){var G=a([]);for(var E=0;E<r(F);E++){G.push(F.find("thead tr:nth-child("+(E+1)+") th:first-child"))}return G}function t(E,F){return E.find("thead tr:nth-child("+(F+1)+") th")}function q(F){var E=h;if(!E){var G=n(F);G.each(function(){E+=a(this).outerHeight(true)});h=E}return E}function v(F){var G=a([]);for(var E=0;E<j.scroll.leftCol.fixedSpan;E++){G.push(F.find("tbody tr:first-child td:nth-child("+(E+1)+")"))}return G}function B(F){var E=k;if(!E){var G=v(F);G.each(function(){E+=a(this).outerWidth(true)});k=E}return E}function e(F){var E=0;F.find("tbody tr:first-child td").each(function(){E+=a(this).outerWidth(true)});return E}function m(E){E.wrap(a(document.createElement("div")).attr("id",j.wrapper.outer.idName).addClass(j.wrapper.outer.className).css("width",u(E)).css("height",y(E)).css("position","relative").css("padding-left",B(E)+"px").css("padding-top",q(E)+"px").css("overflow","hidden"))}function l(E){E.wrap(a(document.createElement("div")).attr("id",j.wrapper.inner.idName).addClass(j.wrapper.inner.className).css("overflow-x",j.scroll.headRow.overflow).css("overflow-y",j.scroll.leftCol.overflow).css("width",u(E)).css("height",y(E)))}function b(F){var G=B(F);var E=e(F);F.css("border-collapse","collapse").css("width",(E-G)+"px")}function p(F){var G=n(F);var E=0;G.each(function(I){var J=t(F,I);var H=0;J.each(function(L){var M=a(this).outerWidth(true);var K=a(this).outerHeight(true);H+=M;if(L==0){E+=K}a(this).addClass(j.scroll.headRow.className).css("position","absolute").css("top",(E-K)+"px").css("left",(H-M)+"px")})})}function g(F){var G=B(F);var E=e(F);F.find("tbody tr").each(function(){a(this).css("width",(E-G)+"px")})}function c(F){var E=0;var G=v(F);G.each(function(H){var I=a(this).outerWidth(true);E+=I;F.find("tbody tr td:nth-child("+(H+1)+")").addClass(j.scroll.leftCol.className).css("position","absolute").css("left",(E-I)+"px")})}function w(E){E.find("tbody tr").each(function(){var H=0;for(var F=0;F<j.scroll.leftCol.fixedSpan;F++){var G=a(this).find("td:nth-child("+(F+1)+")").height();if(G>H){H=G}}a(this).find("td:nth-child("+(j.scroll.leftCol.fixedSpan+1)+")").height(H);a(this).hide().fadeIn(0)})}function A(G){var F=a("<div></div>").attr("id",j.corner.outer.idName).addClass(j.corner.outer.className).css("position","absolute").css("left","0px").css("top","0px").css("margin","0").css("padding","0").css("width",B(G)+"px").css("height",q(G)+"px");var E=a("<table></table>").attr("id",j.corner.inner.idName).addClass(j.corner.inner.className).css("border-collapse","collapse");var I=a("<thead></thead>");var H=s(G);H.each(function(){var J=a("<tr></tr>");a(this).each(function(){var K=a(this).clone(j.corner.deepClone);a(this).removeAttr("id");a(this).unbind();K.appendTo(J)});J.appendTo(I)});I.appendTo(E);E.appendTo(F);F.appendTo(G.parent())}function x(E){c(E);g(E);p(E);b(E);m(E);l(E);w(E);if(j.corner.append){A(E)}}function D(E){E.find("tbody tr").each(function(){for(var F=0;F<j.scroll.leftCol.fixedSpan;F++){a(this).find("td:nth-child("+(F+1)+")").css("top",a(this).find("td:nth-child("+(j.scroll.leftCol.fixedSpan+1)+")").position().top+"px")}})}function C(E){E.find("thead tr").each(function(F){if(F<r(E)){a(this).find("th").each(function(G){a(this).css("left",E.find("tbody tr:first-child td:nth-child("+(G+1)+")").position().left+"px")})}})}function d(F,E){E.scrollTop(F.scrollTop());E.scrollLeft(F.scrollLeft())}function f(E){var F=j.scroll.syncWith;if(a.isArray(F)){a.each(F,function(){d(E,a(this.toString()).parent())})}else{d(E,a(F).parent())}}return this.each(function(){if(a(this)[0].tagName.toLowerCase()!="table"){return true}x(a(this));if(j.scroll.leftCol.enabled||j.scroll.headRow.enabled){a(this).parent().scroll(function(){if(j.scroll.headRow.enabled){C(a(this))}if(j.scroll.leftCol.enabled){D(a(this))}if(j.scroll.syncWith){f(a(this))}})}})}})})(jQuery);