/* jshint devel:true */
var overlayMenu = false;
var overlayContact = false;

var leScroll = (function (leScroll) {
    'use strict';

    var currentSectionNumber = 0;

    var sectionCount = document.querySelectorAll('section').length - 1;

    var maskHeight = document.getElementById('mask').offsetHeight;

    var iOS = (navigator.userAgent.match(/(iPad|iPhone|iPod)/g) ? true : false);

    leScroll.scrolling = false;

    leScroll.move = function () {
        if (iOS) {
            document.getElementById('mask-main').style.top = '-' + (currentSectionNumber * maskHeight) + 'px';
        } else {
            document.getElementById('mask-main').style.top = '-' + (currentSectionNumber * window.innerHeight) + 'px';
        }
    };

    leScroll.moveUp = function () {
        if (currentSectionNumber === 0) {
            return;
        }
        currentSectionNumber--;
        leScroll.move();
    };

    leScroll.moveDown = function () {
        if (currentSectionNumber === sectionCount) {
            return;
        }
        currentSectionNumber++;
        leScroll.move();
    };

    leScroll.moveTo = function (sectionNumber) {
        currentSectionNumber = sectionNumber;
        leScroll.move();
    };

    leScroll.addEvent = function (element, sectionNumber) {
        document.querySelector(element).addEventListener('click', function () {
            leScroll.moveTo(sectionNumber);
        });
    };

    leScroll.setScrollTimeout = function (ms) {
        setTimeout(function () {
            leScroll.scrolling = false;
        }, ms);
    };

    return leScroll;

})(leScroll || {});


(function (window, document, leScroll, undefined) {
    'use strict';

    var listItems = document.getElementsByTagName('li');

    var keyCodes = {
        up: 38,
        down: 40
    };

    var wheel = function (event) {
        var delta = 0;
        var currentEvent = event || window.event;

        if (currentEvent.wheelDelta) {
            delta = (window.opera ? -1 : 1) * currentEvent.wheelDelta / 120;
        } else if (currentEvent.detail) {
            delta = -currentEvent.detail / 3;
        }

        if (delta) {
            mousewheelHandle(delta);
        }
    };

    var mousewheelHandle = function (delta) {
        if(overlayMenu || overlayContact) {
            return;
        }

        if (leScroll.scrolling) {
            return;
        }
        if (delta > 0) {
            leScroll.scrolling = true;
            leScroll.moveUp();
            leScroll.setScrollTimeout(1000);
        } else if (delta <= 0) {
            leScroll.scrolling = true;
            leScroll.moveDown();
            leScroll.setScrollTimeout(1000);
        }
    };

    var navHandler = function () {
        leScroll.moveTo(event.target.getAttribute('data-section'));
    };

    for (var i = 0; i < listItems.length; i++) {
        if (listItems[i].getAttribute('data-section')) {
            listItems[i].addEventListener('click', navHandler);
        }
    }

    window.addEventListener('keydown', function (event) {
        if (event.keyCode === keyCodes.up) {
            leScroll.moveUp();
        } else if (event.keyCode === keyCodes.down) {
            leScroll.moveDown();
        }
    });

    window.addEventListener('resize', function () {
        leScroll.move();
    });

    window.addEventListener('DOMMouseScroll', wheel, false);

    window.onmousewheel = document.onmousewheel = wheel;


    // Touch scroll

    // document.addEventListener('touchstart', handleTouchStart, false);
    // document.addEventListener('touchmove', handleTouchMove, false);
    //
    // var xDown = null;
    // var yDown = null;
    //
    // function getTouches(evt) {
    //     return evt.touches ||             // browser API
    //         evt.originalEvent.touches; // jQuery
    // }
    //
    // function handleTouchStart(evt) {
    //     xDown = getTouches(evt)[0].clientX;
    //     yDown = getTouches(evt)[0].clientY;
    // };
    //
    // function handleTouchMove(evt) {
    //     if (!xDown || !yDown) {
    //         return;
    //     }
    //
    //     var xUp = evt.touches[0].clientX;
    //     var yUp = evt.touches[0].clientY;
    //
    //     var xDiff = xDown - xUp;
    //     var yDiff = yDown - yUp;
    //
    //     if (Math.abs(xDiff) > Math.abs(yDiff)) {/*most significant*/
    //         if (xDiff > 0) {
    //             /* left swipe */
    //         } else {
    //             /* right swipe */
    //         }
    //     } else {
    //         if (yDiff > 0) {
    //             /* up swipe */
    //             // mousewheelHandle(-yDiff);
    //             console.log('up')
    //             leScroll.scrolling = true;
    //             leScroll.moveDown();
    //             leScroll.setScrollTimeout(200);
    //         } else {
    //             /* down swipe */
    //             console.log('down')
    //             // mousewheelHandle(yDiff);
    //             leScroll.scrolling = true;
    //             leScroll.moveUp();
    //             leScroll.setScrollTimeout(200);
    //         }
    //     }
    //     /* reset values */
    //     xDown = null;
    //     yDown = null;
    // };

})(window, document, leScroll);
